<div class="zen-flow-container">
  <header class="game-header">
    <h1>{{ title }}</h1>
    <div class="game-info">
      <span>Estado: {{ gameState() }}</span>
      <span>FPS: {{ fps() }}</span>
    </div>
  </header>

  <section class="game-main" *ngIf="gameState() === 'playing'; else menuScreen">
  <aside class="player-info" *ngIf="player() as pl">
      <div class="stat"><label>Energ√≠a:</label><span>{{ pl.energy }}/{{ pl.maxEnergy }}</span></div>
      <div class="stat"><label>Puntuaci√≥n:</label><span>{{ pl.score }}</span></div>
      <div class="stat"><label>Nivel:</label><span>{{ pl.level }}</span></div>
      <div class="stat"><label>Progreso Zen:</label><span>{{ (pl.zenProgress * 100).toFixed(1) }}%</span></div>
      <div class="stat"><label>Posici√≥n:</label><span>{{ pl.position.x.toFixed(0) }}, {{ pl.position.y.toFixed(0) }}</span></div>

      <div class="game-controls">
        <button (click)="startNormalGame()" [disabled]="isPlaying()">Normal</button>
        <button (click)="startMeditationGame()" [disabled]="isPlaying()">Meditaci√≥n</button>
        <button (click)="togglePause()" [disabled]="gameState() === 'menu'">{{ isPlaying() ? 'Pausar' : 'Reanudar' }}</button>
        <button (click)="handlePlayerInput()" [disabled]="!isPlaying()">Impulso</button>
      </div>

      <div class="panel-config">
        <h3>Config</h3>
        <div class="cfg-item">
          <label>Dificultad</label>
          <select>
            <option value="easy">Easy</option>
            <option value="normal" selected>Normal</option>
            <option value="hard">Hard</option>
          </select>
        </div>
        <div class="cfg-item">
          <label>Densidad Part√≠culas</label>
          <input type="range" min="0" max="1" step="0.05" value="0.6"/>
        </div>
        <div class="cfg-item">
          <label><input type="checkbox" checked/> HUD</label>
        </div>
        <div class="cfg-item">
          <label><input type="checkbox"/> Debug</label>
        </div>
      </div>
    </aside>

    <div class="canvas-container">
      <app-game-canvas />
    </div>
  </section>

  <ng-template #menuScreen>
    <div class="menu-screen">
      <div class="menu-content">
        <div class="logo-section">
          <div class="zen-symbol">‚òØ</div>
          <h1 class="game-title">Zen Flow</h1>
          <p class="game-subtitle">Encuentra tu equilibrio interior</p>
        </div>

        <div class="game-description">
          <p>Un viaje meditativo donde el flujo de part√≠culas representa la expansi√≥n de tu conciencia. Mant√©n el equilibrio, crea patrones y alcanza el estado zen perfecto.</p>
        </div>

        <div class="mode-selection">
          <h2>Selecciona tu Modo</h2>

          <div class="mode-cards">
            <div class="mode-card zen-mode" (click)="startMeditationGame()">
              <div class="mode-icon">‚òØ</div>
              <h3>Modo Zen</h3>
              <p>Meditaci√≥n pura. Mant√©n la estabilidad del v√≥rtice y encuentra tu centro interior.</p>
              <div class="mode-features">
                <span class="feature">Estabilidad</span>
                <span class="feature">Meditaci√≥n</span>
                <span class="feature">Armon√≠a</span>
              </div>
              <button class="mode-button zen-btn">Comenzar Meditaci√≥n</button>
            </div>

            <div class="mode-card flow-mode" (click)="startNormalGame()">
              <div class="mode-icon">üåä</div>
              <h3>Modo Flow</h3>
              <p>Expresi√≥n creativa. Crea patrones din√°micos y explora el flujo de energ√≠a.</p>
              <div class="mode-features">
                <span class="feature">Creatividad</span>
                <span class="feature">Dinamismo</span>
                <span class="feature">Arte</span>
              </div>
              <button class="mode-button flow-btn">Iniciar Flow</button>
            </div>

            <div class="mode-card challenge-mode" (click)="startChallengeGame()">
              <div class="mode-icon">‚ö°</div>
              <h3>Modo Challenge</h3>
              <p>Prueba tus l√≠mites. Sobrevive perturbaciones crecientes y demuestra tu maestr√≠a zen.</p>
              <div class="mode-features">
                <span class="feature">Desaf√≠o</span>
                <span class="feature">Resistencia</span>
                <span class="feature">Maestr√≠a</span>
              </div>
              <button class="mode-button challenge-btn">Aceptar Desaf√≠o</button>
            </div>
          </div>
        </div>

        <div class="menu-footer">
          <div class="quick-stats">
            <div class="stat-item">
              <span class="stat-label">Mejor Puntuaci√≥n</span>
              <span class="stat-value">{{ getHighScore() }}</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Sesiones</span>
              <span class="stat-value">{{ getTotalSessions() }}</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Tiempo Zen</span>
              <span class="stat-value">{{ getTotalZenTime() }}</span>
            </div>
          </div>

          <div class="menu-controls">
            <button class="settings-btn" (click)="toggleSettings()">
              <span>‚öôÔ∏è</span> Configuraci√≥n
            </button>
            <button class="tutorial-btn" (click)="showTutorial()">
              <span>üìö</span> Tutorial
            </button>
          </div>
        </div>
      </div>

      <!-- Settings Panel -->
      <div class="settings-panel" *ngIf="showSettings">
        <div class="settings-content">
          <h3>Configuraci√≥n del Juego</h3>

          <div class="setting-group">
            <h4>Visual</h4>
            <div class="setting-item">
              <label>Part√≠culas: {{ particleDensity }}</label>
              <input type="range" min="0.1" max="1" step="0.1"
                     [(ngModel)]="particleDensity" (input)="updateParticleDensity()">
            </div>
            <div class="setting-item">
              <label>
                <input type="checkbox" [(ngModel)]="showTrails"> Mostrar estelas
              </label>
            </div>
            <div class="setting-item">
              <label>
                <input type="checkbox" [(ngModel)]="enableGlow"> Efectos de brillo
              </label>
            </div>
          </div>

          <div class="setting-group">
            <h4>Audio</h4>
            <div class="setting-item">
              <label>Volumen: {{ audioVolume }}</label>
              <input type="range" min="0" max="1" step="0.1"
                     [(ngModel)]="audioVolume" (input)="updateAudioVolume()">
            </div>
            <div class="setting-item">
              <label>
                <input type="checkbox" [(ngModel)]="enableSound"> Efectos sonoros
              </label>
            </div>
          </div>

          <div class="setting-group">
            <h4>Juego</h4>
            <div class="setting-item">
              <label>Dificultad</label>
              <select [(ngModel)]="gameDifficulty">
                <option value="easy">F√°cil</option>
                <option value="normal">Normal</option>
                <option value="hard">Dif√≠cil</option>
                <option value="zen">Zen Master</option>
              </select>
            </div>
          </div>

          <div class="settings-actions">
            <button class="save-btn" (click)="saveSettings()">Guardar</button>
            <button class="cancel-btn" (click)="toggleSettings()">Cerrar</button>
          </div>
        </div>
      </div>
    </div>
  </ng-template>

  <footer class="game-footer">
    Zen Flow ¬© 2025 ‚Äî Sistema Base & Render Loop activos
  </footer>
</div>
